import{_ as F,c as x,i as E,r as k,o as S,a as r,b as a,t as d,u as m,h as V,w as v,j as f,v as y,n as g,k as j,F as N,e as D,f as U,g as u}from"./index-Cp2leT6j.js";import{u as C}from"./expense-B1I-Xo3m.js";import{u as M}from"./category-_7hyEaxh.js";const B={class:"expense-form"},K={key:0,class:"loading"},I={key:1,class:"error"},W={class:"form-group"},A={key:0,class:"error-message"},R={class:"form-group"},$={key:0,class:"error-message"},L={class:"form-group"},O=["value"],T={class:"form-group"},q={key:0,class:"error-message"},G={class:"form-actions"},H={type:"submit",class:"submit-button"},J={__name:"ExpenseFormView",setup(P){const w=E(),c=U(),n=C(),_=M(),i=x(()=>w.name==="expense-edit"),p=x(()=>w.params.id),t=k({name:"",amount:"",category_id:null,date:new Date().toISOString().substr(0,10)}),s=k({}),b=()=>{s.value={};let o=!0;return t.value.name||(s.value.name="Nazwa jest wymagana",o=!1),t.value.amount?(isNaN(t.value.amount)||parseFloat(t.value.amount)<0)&&(s.value.amount="Kwota musi być liczbą dodatnią",o=!1):(s.value.amount="Kwota jest wymagana",o=!1),t.value.date||(s.value.date="Data jest wymagana",o=!1),o},z=async()=>{if(b())try{const o={...t.value,amount:parseFloat(t.value.amount)};i.value?(await n.updateExpense(p.value,o),alert("Wydatek zaktualizowany pomyślnie")):(await n.createExpense(o),alert("Wydatek utworzony pomyślnie")),c.push({name:"expenses"})}catch(o){alert(`Błąd ${i.value?"aktualizacji":"tworzenia"} wydatku: ${o.message||"Nieznany błąd"}`)}},h=()=>{i.value?c.push({name:"expense-details",params:{id:p.value}}):c.push({name:"expenses"})};return S(async()=>{try{await _.fetchCategories()}catch(o){console.error("Failed to fetch categories:",o)}if(i.value)try{await n.fetchExpense(p.value),n.expense&&(t.value={name:n.expense.name,amount:n.expense.amount,category_id:n.expense.category_id||null,date:n.expense.date})}catch(o){console.error("Failed to fetch expense details:",o)}}),(o,e)=>(u(),r("div",B,[a("h1",null,d(i.value?"Edytuj wydatek":"Utwórz nowy wydatek"),1),i.value&&m(n).loading?(u(),r("div",K," Ładowanie danych wydatku... ")):i.value&&m(n).error?(u(),r("div",I,d(m(n).error),1)):(u(),r("form",{key:2,onSubmit:V(z,["prevent"]),class:"form"},[a("div",W,[e[4]||(e[4]=a("label",{for:"name"},"Nazwa",-1)),v(a("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=l=>t.value.name=l),type:"text",class:g(["form-control",{"is-invalid":s.value.name}])},null,2),[[y,t.value.name]]),s.value.name?(u(),r("div",A,d(s.value.name),1)):f("",!0)]),a("div",R,[e[5]||(e[5]=a("label",{for:"amount"},"Kwota",-1)),v(a("input",{id:"amount","onUpdate:modelValue":e[1]||(e[1]=l=>t.value.amount=l),type:"number",step:"0.01",min:"0",class:g(["form-control",{"is-invalid":s.value.amount}])},null,2),[[y,t.value.amount]]),s.value.amount?(u(),r("div",$,d(s.value.amount),1)):f("",!0)]),a("div",L,[e[7]||(e[7]=a("label",{for:"category_id"},"Kategoria",-1)),v(a("select",{id:"category_id","onUpdate:modelValue":e[2]||(e[2]=l=>t.value.category_id=l),class:"form-control"},[e[6]||(e[6]=a("option",{value:""},"Wybierz kategorię",-1)),(u(!0),r(N,null,D(m(_).categories,l=>(u(),r("option",{key:l.id,value:l.id},d(l.name),9,O))),128))],512),[[j,t.value.category_id]])]),a("div",T,[e[8]||(e[8]=a("label",{for:"date"},"Data",-1)),v(a("input",{id:"date","onUpdate:modelValue":e[3]||(e[3]=l=>t.value.date=l),type:"date",class:g(["form-control",{"is-invalid":s.value.date}])},null,2),[[y,t.value.date]]),s.value.date?(u(),r("div",q,d(s.value.date),1)):f("",!0)]),a("div",G,[a("button",{type:"button",onClick:h,class:"cancel-button"},"Anuluj"),a("button",H,d(i.value?"Aktualizuj":"Utwórz"),1)])],32))]))}},Z=F(J,[["__scopeId","data-v-14f1ac52"]]);export{Z as default};
