import{_ as x,c as _,i as C,r as f,o as V,a as r,b as e,t as d,u as m,h as F,j as y,w as v,v as j,n as k,p as b,k as U,F as K,e as N,f as S,g as l}from"./index-Cp2leT6j.js";import{u as B}from"./category-_7hyEaxh.js";const I={class:"category-form"},E={key:0,class:"loading"},R={key:1,class:"error"},A={class:"form-group"},D={key:0,class:"error-message"},T={class:"form-group"},W={class:"checkbox-container"},$=["checked"],L={class:"form-group"},P={class:"radio-container"},q={class:"radio-option"},G={class:"radio-option"},H={key:0,class:"form-group"},J=["value"],O={key:0,class:"error-message"},Q={class:"form-actions"},X={type:"submit",class:"submit-button"},Y={__name:"CategoryFormView",setup(Z){const g=C(),p=S(),i=B(),s=_(()=>g.name==="category-edit"),c=_(()=>g.params.id),t=f({name:"",isMain:!1,parent_id:null,is_income:!1}),n=f({}),w=()=>{n.value={};let u=!0;return t.value.name||(n.value.name="Nazwa jest wymagana",u=!1),!t.value.isMain&&!t.value.parent_id&&(n.value.parent_id="Kategoria podrzędna musi mieć kategorię nadrzędną",u=!1),u},M=async()=>{if(w())try{s.value?(await i.updateCategory(c.value,t.value),alert("Kategoria zaktualizowana pomyślnie")):(await i.createCategory(t.value),alert("Kategoria utworzona pomyślnie")),p.push({name:"categories"})}catch(u){alert(`Błąd ${s.value?"aktualizacji":"tworzenia"} kategorii: ${u.message||"Nieznany błąd"}`)}},z=()=>{s.value?p.push({name:"category-details",params:{id:c.value}}):p.push({name:"categories"})},h=()=>{t.value.isMain=!t.value.isMain,t.value.isMain&&(t.value.parent_id=null)};return V(async()=>{if(await i.fetchCategories(),s.value)try{await i.fetchCategory(c.value),i.category&&(t.value={name:i.category.name,isMain:i.category.isMain,parent_id:i.category.parent_id,is_income:i.category.is_income})}catch(u){console.error("Failed to fetch category details:",u)}}),(u,a)=>(l(),r("div",I,[e("h1",null,d(s.value?"Edytuj kategorię":"Utwórz nową kategorię"),1),s.value&&m(i).loading?(l(),r("div",E," Ładowanie danych kategorii... ")):s.value&&m(i).error?(l(),r("div",R,d(m(i).error),1)):(l(),r("form",{key:2,onSubmit:F(M,["prevent"]),class:"form"},[e("div",A,[a[4]||(a[4]=e("label",{for:"name"},"Nazwa",-1)),v(e("input",{id:"name","onUpdate:modelValue":a[0]||(a[0]=o=>t.value.name=o),type:"text",class:k(["form-control",{"is-invalid":n.value.name}])},null,2),[[j,t.value.name]]),n.value.name?(l(),r("div",D,d(n.value.name),1)):y("",!0)]),e("div",T,[e("div",W,[e("input",{id:"isMain",checked:t.value.isMain,type:"checkbox",onChange:h},null,40,$),a[5]||(a[5]=e("label",{for:"isMain",class:"checkbox-label"},"Kategoria główna",-1))])]),e("div",L,[a[8]||(a[8]=e("label",null,"Typ kategorii",-1)),e("div",P,[e("div",q,[v(e("input",{id:"type-expense","onUpdate:modelValue":a[1]||(a[1]=o=>t.value.is_income=o),value:!1,type:"radio",name:"category-type"},null,512),[[b,t.value.is_income]]),a[6]||(a[6]=e("label",{for:"type-expense",class:"radio-label"},"Wydatek",-1))]),e("div",G,[v(e("input",{id:"type-income","onUpdate:modelValue":a[2]||(a[2]=o=>t.value.is_income=o),value:!0,type:"radio",name:"category-type"},null,512),[[b,t.value.is_income]]),a[7]||(a[7]=e("label",{for:"type-income",class:"radio-label"},"Przychód",-1))])])]),t.value.isMain?y("",!0):(l(),r("div",H,[a[10]||(a[10]=e("label",{for:"parent_id"},"Kategoria nadrzędna",-1)),v(e("select",{id:"parent_id","onUpdate:modelValue":a[3]||(a[3]=o=>t.value.parent_id=o),class:k(["form-control",{"is-invalid":n.value.parent_id}])},[a[9]||(a[9]=e("option",{value:""},"Wybierz kategorię nadrzędną",-1)),(l(!0),r(K,null,N(m(i).categories.filter(o=>o.isMain&&(!s.value||o.id!==parseInt(c.value))),o=>(l(),r("option",{key:o.id,value:o.id},d(o.name),9,J))),128))],2),[[U,t.value.parent_id]]),n.value.parent_id?(l(),r("div",O,d(n.value.parent_id),1)):y("",!0)])),e("div",Q,[e("button",{type:"button",onClick:z,class:"cancel-button"},"Anuluj"),e("button",X,d(s.value?"Aktualizuj":"Utwórz"),1)])],32))]))}},te=x(Y,[["__scopeId","data-v-59e91701"]]);export{te as default};
